<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JLPT 词汇挑战</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* 使用 Inter 字体以获得现代感 */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb; /* 浅灰色背景 */
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'accent-blue': '#3b82f6',
                        'accent-dark': '#1e293b',
                    }
                }
            }
        }
    </script>
</head>
<body class="min-h-screen p-4 sm:p-8">

    <div id="app" class="max-w-4xl mx-auto">
        <header class="text-center mb-10">
            <h1 class="text-4xl font-extrabold text-accent-dark mb-2">
                JLPT 词汇挑战
            </h1>
            <p class="text-lg text-gray-500">
                每次点击获取 10 个核心词汇，支持 N5 至 N1 范围选择。
            </p>
        </header>

        <div class="flex flex-col sm:flex-row items-center justify-center mb-8 space-y-4 sm:space-y-0 sm:space-x-6">
            
            <div class="flex flex-col sm:flex-row sm:space-x-6 bg-white p-4 rounded-xl shadow-md border border-gray-200 justify-center">
                
                <div class="flex items-center space-x-2 mb-4 sm:mb-0">
                    <label for="startLevelSelector" class="font-medium text-gray-700 whitespace-nowrap">起始等级 (较简单):</label>
                    <select id="startLevelSelector" class="p-2 border border-gray-300 rounded-lg focus:ring-accent-blue focus:border-accent-blue transition duration-150">
                        <option value="N5">N5 - 初级</option>
                        <option value="N4">N4 - 初中级</option>
                        <option value="N3" selected>N3 - 中级</option>
                        <option value="N2">N2 - 中高级</option>
                        <option value="N1">N1 - 高级</option>
                    </select>
                </div>
                
                <div class="flex items-center space-x-2">
                    <label for="endLevelSelector" class="font-medium text-gray-700 whitespace-nowrap">结束等级 (较难):</label>
                    <select id="endLevelSelector" class="p-2 border border-gray-300 rounded-lg focus:ring-accent-blue focus:border-accent-blue transition duration-150">
                        <option value="N5">N5 - 初级</option>
                        <option value="N4">N4 - 初中级</option>
                        <option value="N3">N3 - 中级</option>
                        <option value="N2">N2 - 中高级</option>
                        <option value="N1" selected>N1 - 高级</option>
                    </select>
                </div>
            </div>

            <button id="fetchButton"
                    class="px-8 py-3 bg-accent-blue text-white font-semibold rounded-xl shadow-lg hover:bg-blue-600 transition duration-300 transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-accent-blue/50 disabled:bg-gray-400">
                ✨ 获取新词汇
            </button>
        </div>

        <div id="statusMessage" class="text-center text-sm text-gray-600 mb-4"></div>

        <div id="vocabularyContainer" class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="md:col-span-2 text-center text-gray-400 p-12 bg-white rounded-xl shadow-inner">
                点击 "获取新词汇" 按钮来开始学习吧！
            </div>
        </div>
    </div>

    <script>
        // ⚠️ 必填：请将此处的 URL 替换为您真实的 Vercel 域名！
        const API_URL_BASE = "https://vercel-api-proxy.805064439.workers.dev/api/n1-vocab";

        const fetchButton = document.getElementById('fetchButton');
        const startLevelSelector = document.getElementById('startLevelSelector');
        const endLevelSelector = document.getElementById('endLevelSelector');
        const statusMessage = document.getElementById('statusMessage');
        const vocabularyContainer = document.getElementById('vocabularyContainer');

        /**
         * 显示状态信息并启用/禁用按钮
         * @param {string} message - 要显示的消息
         * @param {boolean} isLoading - 是否正在加载
         */
        function setStatus(message, isLoading) {
            statusMessage.textContent = message;
            fetchButton.disabled = isLoading;
            fetchButton.textContent = isLoading ? '🚀 正在生成中...' : '✨ 获取新词汇';
        }

        // 辅助函数：根据 JLPT 等级返回 Tailwind CSS 颜色类
        function getLevelColorClasses(level) {
            switch (level.toUpperCase()) {
                case 'N5': return 'bg-blue-100 text-blue-700';
                case 'N4': return 'bg-cyan-100 text-cyan-700';
                case 'N3': return 'bg-green-100 text-green-700';
                case 'N2': return 'bg-yellow-100 text-yellow-700';
                case 'N1': return 'bg-red-100 text-red-700';
                default: return 'bg-gray-100 text-gray-700';
            }
        }

        /**
         * 创建单个词汇卡片
         * @param {object} vocab - 包含词汇信息的对象 (假设包含 vocab.jlpt_level 字段)
         * @returns {string} HTML 字符串
         */
        function createCard(vocab) {
            // 关键修改：从 vocab 对象中获取实际等级
            // 如果后端返回的字段名是 'level' 或 'grade'，请将 'jlpt_level' 更改为相应的字段名
            const actualLevel = vocab.jlpt_level || '未知等级'; 
            const levelClasses = getLevelColorClasses(actualLevel);

            return `
                <div class="bg-white p-6 rounded-xl shadow-xl hover:shadow-2xl transition duration-300 border border-gray-100">
                    <div class="flex justify-between items-start mb-3 border-b pb-2 border-dashed">
                        <h3 class="text-3xl font-bold text-accent-dark tracking-wide">${vocab.word}</h3>
                        <div class="flex items-center space-x-3">
                            <span class="text-xs font-bold px-3 py-1 ${levelClasses} rounded-full shadow-inner whitespace-nowrap">
                                ${actualLevel}
                            </span>
                            <span class="text-lg text-gray-500 font-medium">${vocab.reading}</span>
                        </div>
                    </div>

                    <p class="text-lg text-gray-700 font-semibold mb-4">
                        <span class="text-accent-blue mr-2">译:</span> ${vocab.chinese_translation}
                    </p>

                    <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                        <p class="text-base italic text-gray-800 mb-2">
                            ${vocab.example_sentence_jp}
                        </p>
                        <p class="text-sm text-gray-500">
                            ${vocab.example_sentence_cn}
                        </p>
                    </div>
                </div>
            `;
        }
        
        // 辅助函数：提取等级的数字部分
        function getLevelNumber(levelString) {
            return parseInt(levelString.substring(1));
        }

        /**
         * 从 Vercel API 获取词汇数据并渲染
         */
        async function fetchVocabulary() {
            setStatus('', true);
            vocabularyContainer.innerHTML = ''; 
            
            const startLevel = startLevelSelector.value;
            const endLevel = endLevelSelector.value;
            
            // 前端验证：确保起始等级的数字大于等于结束等级的数字 (N5 > N1)
            const startNum = getLevelNumber(startLevel);
            const endNum = getLevelNumber(endLevel);

            if (startNum < endNum) {
                const message = `⚠️ 等级选择错误：起始等级 (${startLevel}) 必须低于或等于结束等级 (${endLevel})。请确保选择的范围是从简单到复杂 (例如 N3 到 N1)。`;
                setStatus(message, false);
                vocabularyContainer.innerHTML = `<div class="md:col-span-2 text-center text-orange-600 p-12 bg-white rounded-xl shadow-inner">${message}</div>`;
                return;
            }

            const fullApiUrl = `${API_URL_BASE}?startLevel=${startLevel}&endLevel=${endLevel}`;

            try {
                setStatus(`正在请求 ${startLevel} 到 ${endLevel} 范围词汇...`, true);
                
                const response = await fetch(fullApiUrl);
                if (!response.ok) {
                    // 尝试读取服务器返回的错误信息
                    let errorBody = await response.text();
                    try {
                        const jsonError = JSON.parse(errorBody);
                        errorBody = jsonError.error || errorBody;
                    } catch {}
                    throw new Error(`HTTP 错误！状态码: ${response.status}. 详情: ${errorBody}`);
                }
                
                const data = await response.json();
                
                if (!data.n1_vocabulary_list || data.n1_vocabulary_list.length === 0) {
                     vocabularyContainer.innerHTML = `<div class="md:col-span-2 text-center text-red-500 p-12 bg-white rounded-xl shadow-inner">API 返回的数据格式有误或列表为空。</div>`;
                     setStatus('获取失败', false);
                     return;
                }

                setStatus(`成功获取 ${data.n1_vocabulary_list.length} 个 ${startLevel}-${endLevel} 范围词汇。`, false);
                
                // 渲染卡片
                // 关键修改：只传递 vocab 对象，以便 createCard 使用 vocab.jlpt_level
                let cardsHtml = data.n1_vocabulary_list.map(vocab => createCard(vocab)).join('');
                vocabularyContainer.innerHTML = cardsHtml;

            } catch (error) {
                console.error("Fetch Error:", error);
                setStatus('获取词汇失败，请检查 API 密钥和 CORS 设置。', false);
                vocabularyContainer.innerHTML = `<div class="md:col-span-2 text-center text-red-500 p-12 bg-white rounded-xl shadow-inner">
                    错误: 无法连接或获取数据。请确认 Vercel 域名是否正确，并检查浏览器控制台了解详情。
                </div>`;
            }
        }

        // 绑定事件监听器
        fetchButton.addEventListener('click', fetchVocabulary);
        
        // 页面加载完成后，显示提示信息
        window.onload = () => {
             setStatus('点击按钮开始。', false);
        };
    </script>
</body>
</html>