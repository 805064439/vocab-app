<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI æ—¥è¯­æ–°é—» - æ¯æ—¥ç²¾é€‰</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <style>
        /* ç»§æ‰¿ Inter å­—ä½“å’ŒèƒŒæ™¯æ ·å¼ */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb;
            /* æµ…ç°è‰²èƒŒæ™¯ */
        }

        /* æ–°é—»æ–‡ç« çš„æ—¥æ–‡éƒ¨åˆ†ï¼Œä½¿ç”¨æ›´æ˜“è¯»çš„å­—ä½“å¤§å°å’Œè¡Œé«˜ */
        .japanese-article {
            font-size: 1.0rem; /* é’ˆå¯¹ç§»åŠ¨è®¾å¤‡ä¼˜åŒ–ï¼Œä» 1.1rem å‡å° */
            line-height: 1.8;
            color: #1e293b;
            /* accent-dark */
        }

        /* çªå‡ºæ˜¾ç¤ºçš„å…³é”®è¯æ ·å¼ï¼Œæ²¿ç”¨è¯æ±‡é¡µé¢çš„çº¢è‰²ç³»å¼ºè°ƒè‰² */
        .keyword-tag {
            background-color: #fef2f2;
            /* red-50 */
            color: #b91c1c;
            /* red-700 */
        }
    </style>
    <script>
        // ç»§æ‰¿è‡ªå®šä¹‰é¢œè‰²é…ç½®
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'accent-blue': '#3b82f6',
                        'accent-dark': '#1e293b',
                    }
                }
            }
        }
    </script>
</head>

<body class="min-h-screen px-2 py-4 sm:p-8">

    <div id="app" class="max-w-4xl mx-auto">

        <header class="text-center mb-10">
            <nav class="mb-8">
                <!-- å¯¼èˆªæŒ‰é’®æ ·å¼ä¿æŒä¸€è‡´ -->
                <a href="index.html"
                    class="inline-flex items-center 
                            px-4 py-2 
                            bg-white text-accent-dark 
                            font-semibold text-sm 
                            rounded-full 
                            shadow-lg hover:shadow-xl hover:bg-gray-50 
                            border border-gray-200 
                            transition duration-200">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0h6">
                        </path>
                    </svg>
                    è¿”å›åŠŸèƒ½é€‰æ‹©é¦–é¡µ
                </a>
            </nav>

            <h1 class="text-3xl sm:text-4xl font-extrabold text-accent-dark mb-2">
                ğŸ“° AI æ—¥è¯­æ–°é—»ç²¾é€‰
            </h1>
            <p class="text-lg text-gray-500">
                é€‰æ‹©ç±»åˆ«ï¼Œè®© AI ç”Ÿæˆä¸€ç¯‡ä¸“ä¸šçš„åœ°é“æ—¥æ–‡æŠ¥é“ã€‚
            </p>
        </header>

        <!-- ä¸»é¢˜é€‰æ‹©å’Œç”ŸæˆæŒ‰é’®åŒºåŸŸ -->
        <div class="flex flex-col sm:flex-row items-center justify-center mb-8 space-y-4 sm:space-y-0 sm:space-x-6">
            
            <!-- ä½¿ç”¨ä¸‹æ‹‰é€‰æ‹©æ¡†ä»£æ›¿æ–‡æœ¬è¾“å…¥æ¡† -->
            <div
                class="flex flex-grow bg-white p-4 rounded-xl shadow-md border border-gray-200 max-w-lg">
                <select
                    id="categorySelect"
                    class="flex-grow p-2 border-none focus:ring-0 focus:outline-none text-gray-700 bg-white"
                >
                    <option value="" disabled selected>--- è¯·é€‰æ‹©æ–°é—»ç±»åˆ« ---</option>
                    <option value="ç§‘å­¦æŠ€è¡“">ç§‘å­¦æŠ€è¡“ (Science & Tech)</option>
                    <option value="çµŒæ¸ˆå‹•å‘">çµŒæ¸ˆå‹•å‘ (Economy)</option>
                    <option value="æ”¿æ²»ãƒ‹ãƒ¥ãƒ¼ã‚¹">æ”¿æ²»ãƒ‹ãƒ¥ãƒ¼ã‚¹ (Politics)</option>
                    <option value="ã‚¹ãƒãƒ¼ãƒ„">ã‚¹ãƒãƒ¼ãƒ„ (Sports)</option>
                    <option value="ã‚¨ãƒ³ã‚¿ãƒ¡">ã‚¨ãƒ³ã‚¿ãƒ¡ (Entertainment)</option>
                    <option value="ç’°å¢ƒå•é¡Œ">ç’°å¢ƒå•é¡Œ (Environment)</option>
                    <option value="ç¤¾ä¼šãƒ‹ãƒ¥ãƒ¼ã‚¹">ç¤¾ä¼šãƒ‹ãƒ¥ãƒ¼ã‚¹ (Society)</option>
                </select>
            </div>

            <button id="generateNewsButton"
                class="px-8 py-3 bg-accent-blue text-white font-semibold rounded-xl shadow-lg hover:bg-blue-600 transition duration-300 transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-accent-blue/50 disabled:bg-gray-400">
                ğŸš€ ç”Ÿæˆå½“æ—¥æ–°é—»
            </button>
        </div>

        <div id="statusMessage" class="text-center text-sm text-gray-600 mb-6"></div>

        <!-- æ–°é—»å±•ç¤ºå®¹å™¨ -->
        <div id="newsContainer" class="max-w-3xl mx-auto">
            <div class="text-center text-gray-400 p-12 bg-white rounded-xl shadow-inner">
                è¯·é€‰æ‹©ä¸€ä¸ªç±»åˆ«å¹¶ç‚¹å‡» "ç”Ÿæˆå½“æ—¥æ–°é—»" æŒ‰é’®ã€‚
            </div>
        </div>
    </div>

    <script>
        // API URL å·²é…ç½®ä¸ºæ‚¨æä¾›çš„å®é™…åç«¯åœ°å€ã€‚
        const API_URL_NEWS = "https://vocab-api-server-on-vercel.vercel.app/api/japanese-news"; 

        const generateNewsButton = document.getElementById('generateNewsButton');
        // æ›¿æ¢ä¸ºä¸‹æ‹‰é€‰æ‹©æ¡†çš„ID
        const categorySelect = document.getElementById('categorySelect');
        const statusMessage = document.getElementById('statusMessage');
        const newsContainer = document.getElementById('newsContainer');

        const FRONTEND_TIMEOUT_MS = 60000;

        /**
         * æ˜¾ç¤ºçŠ¶æ€ä¿¡æ¯å¹¶å¯ç”¨/ç¦ç”¨æŒ‰é’®
         */
        function setStatus(message, isLoading) {
            statusMessage.textContent = message;
            generateNewsButton.disabled = isLoading;

            const timeoutSeconds = FRONTEND_TIMEOUT_MS / 1000;
            generateNewsButton.textContent = isLoading
                ? `ğŸš€ æ­£åœ¨å‘AIè¯·æ±‚æ•°æ® (è¯·è€å¿ƒç­‰å¾…ï¼Œæœ€é•¿ ${timeoutSeconds} ç§’)...`
                : 'ğŸš€ ç”Ÿæˆå½“æ—¥æ–°é—»';
        }

        /**
         * åˆ›å»ºæ–°é—»æ–‡ç« å¡ç‰‡
         * @param {object} newsData - æ–°é—»æ•°æ®å¯¹è±¡
         */
        function createNewsCard(newsData) {
            const keywordsHtml = newsData.keywords.map(keyword =>
                `<span class="keyword-tag inline-block px-3 py-1 text-xs font-semibold rounded-full mr-2 mb-2">#${keyword}</span>`
            ).join('');

            // ä½¿ç”¨ä¸è¯æ±‡å¡ç‰‡ç›¸åŒçš„â€œç™½è‰²å¤§å¡ç‰‡ + é˜´å½±/åœ†è§’â€é£æ ¼
            return `
                <div class="bg-white p-4 sm:p-8 rounded-xl shadow-2xl transition duration-300 border border-gray-100">
                    <h2 class="text-3xl sm:text-4xl font-extrabold text-accent-dark mb-2">
                        ${newsData.title}
                    </h2>
                    
                    <p class="text-sm text-gray-500 mb-6 border-b pb-4 border-dashed">
                        æ¥æºå»ºè®®: ${newsData.suggested_source || 'AIç”Ÿæˆ'} | 
                        <span class="font-medium text-red-600">æœ€æ–°ç”Ÿæˆ</span>
                    </p>

                    <!-- æ—¥æ–‡æ–‡ç« ä¸»ä½“ -->
                    <div class="bg-gray-50 p-4 sm:p-6 rounded-lg border border-gray-200 mb-6">
                        <p class="japanese-article whitespace-pre-wrap">${newsData.article_jp}</p>
                    </div>

                    <!-- ä¸­æ–‡æ‘˜è¦å’Œå…³é”®è¯ -->
                    <div class="mb-4">
                        <h3 class="text-lg font-bold text-accent-blue mb-2">ä¸­æ–‡æ‘˜è¦ (Summary)</h3>
                        <p class="text-gray-700">${newsData.article_cn_summary}</p>
                    </div>

                    <div class="mt-6 border-t pt-4">
                        <h3 class="text-sm font-semibold text-gray-700 mb-2">å…³é”®è¯:</h3>
                        <div>${keywordsHtml}</div>
                    </div>
                </div>
            `;
        }


        /**
         * ä» API è·å–æ–°é—»æ–‡ç« å¹¶æ¸²æŸ“
         */
        async function fetchJapaneseNews() {
            // ä»ä¸‹æ‹‰æ¡†è·å–é€‰å®šçš„ä¸»é¢˜
            const topic = categorySelect.value.trim();
            if (!topic) {
                setStatus('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ–°é—»ç±»åˆ«ï¼', false);
                newsContainer.innerHTML = `<div class="text-center text-orange-600 p-12 bg-white rounded-xl shadow-inner">è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ–°é—»ç±»åˆ«ã€‚</div>`;
                return;
            }

            setStatus('', true);
            newsContainer.innerHTML = '';

            const fullApiUrl = `${API_URL_NEWS}?topic=${encodeURIComponent(topic)}`;

            try {
                setStatus(`æ­£åœ¨è¯·æ±‚ AI æ’°å†™å…³äº "${topic}" çš„æ–°é—»...`, true);

                const response = await axios.get(fullApiUrl, {
                    timeout: FRONTEND_TIMEOUT_MS,
                    validateStatus: (status) => status >= 200 && status < 505
                });

                const data = response.data;

                if (response.status !== 200 || !data.article_jp) {
                    throw new Error(`API é”™è¯¯ï¼çŠ¶æ€ç : ${response.status}. è¯¦æƒ…: ${data.error || 'æœªè¿”å›æœ‰æ•ˆæ–‡ç« '}`);
                }

                setStatus('æ–°é—»æ–‡ç« ç”ŸæˆæˆåŠŸï¼', false);
                newsContainer.innerHTML = createNewsCard(data);

            } catch (error) {
                console.error("Axios Error:", error);

                let displayMessage;
                if (axios.isCancel(error) || error.code === 'ECONNABORTED') {
                    displayMessage = `è¯·æ±‚è¶…æ—¶ï¼AI ç”Ÿæˆæ•°æ®è€—æ—¶è¶…è¿‡ ${FRONTEND_TIMEOUT_MS / 1000} ç§’ã€‚è¯·ç¨åé‡è¯•ã€‚`;
                } else if (error.response) {
                    const status = error.response.status;
                    const errorDetail = error.response.data?.error || error.message;
                    displayMessage = `æœåŠ¡å™¨é”™è¯¯ (${status})ã€‚è¯¦æƒ…: ${errorDetail}`;
                } else {
                    displayMessage = `è·å–æ–°é—»å¤±è´¥ã€‚è¯¦æƒ…: ${error.message}`;
                }

                setStatus(displayMessage, false);
                newsContainer.innerHTML = `<div class="text-center text-red-500 p-12 bg-white rounded-xl shadow-inner">
                    é”™è¯¯: ${displayMessage}
                </div>`;
            }
        }

        // ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
        generateNewsButton.addEventListener('click', fetchJapaneseNews);

        // é¡µé¢åŠ è½½å®Œæˆåçš„å¤„ç†
        window.onload = () => {
            setStatus('ç‚¹å‡»æŒ‰é’®å¼€å§‹ã€‚', false);
        };
    </script>
</body>

</html>
