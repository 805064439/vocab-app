<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥è¯­è¡¨è¾¾è‡ªç„¶åº¦ä¸è¯­æ³•æ£€æŸ¥ (AI é©±åŠ¨)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <style>
        /* ä½¿ç”¨ Inter å­—ä½“ä»¥è·å¾—ç°ä»£æ„Ÿ */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb;
            /* æµ…ç°è‰²èƒŒæ™¯ */
        }

        /* æ ¸å¿ƒä¼˜åŒ–ï¼šå“åº”å¼å­—ä½“å¤§å° - é’ˆå¯¹æ‰‹æœºç«¯ï¼ˆé»˜è®¤ï¼‰çš„å­—ä½“è°ƒæ•´ */
        .h1-responsive {
            font-size: 2.25rem;
            /* text-3xl 4xl ä¹‹é—´çš„å€¼ */
        }

        .text-responsive {
            font-size: 1rem;
            /* åŸºç¡€æ–‡æœ¬ */
        }

        .h2-responsive {
            font-size: 1.25rem;
            /* text-xl å·¦å³ */
        }

        /* åœ¨ä¸­ç­‰å±å¹•åŠä»¥ä¸Šï¼ˆmd:ï¼‰æ¢å¤æˆ–ä½¿ç”¨æ›´å¤§å­—ä½“ */
        @media (min-width: 768px) {
            .h1-responsive {
                font-size: 3rem;
                /* md:text-4xl */
            }

            .text-responsive {
                font-size: 1.125rem;
                /* md:text-lg */
            }

            .h2-responsive {
                font-size: 1.5rem;
                /* md:text-2xl */
            }
        }

        /* ğŸ’¥ æ–°å¢æ ·å¼ï¼šAI è¯„ä¼°ç»“æœçš„å®¹å™¨å’Œæ–‡æœ¬ (é†’ç›®çš„é»„è‰²ç›’å­) */
        .ai-assessment-box {
            background-color: #fef3c7;
            /* bg-amber-100 æµ…é»„è‰² */
            border: 2px solid #f59e0b;
            /* border-amber-500 */
            color: #78350f;
            /* text-amber-900 */
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .ai-assessment-title {
            font-weight: 700;
            font-size: 1.25rem;
            /* text-xl */
            margin-bottom: 0.5rem;
        }

        /* å¼ºè°ƒ AI æ ‡è®°å‡ºçš„å…³é”®å­— */
        .highlight-md {
            color: #dc2626;
            /* text-red-600 */
            font-weight: 700;
            /* åŠ ç²— */
        }

        /* ä¼˜åŒ–ç»“æœå†…å®¹çš„æ’ç‰ˆï¼Œæé«˜å¯è¯»æ€§ */
        #resultContent {
            font-size: 1rem;
            /* æ‰‹æœºç«¯åŸºç¡€å­—ä½“ */
            line-height: 1.65;
            /* å¢åŠ è¡Œè· */
            white-space: pre-wrap;
            /* ä¿æŒè¾“å…¥æ—¶çš„ç©ºæ ¼å’Œæ¢è¡Œ */
        }

        @media (min-width: 768px) {
            #resultContent {
                font-size: 1.05rem;
                /* æ¡Œé¢ç«¯ç¨å¾®æ”¾å¤§ */
            }
        }

        /* ä¼˜åŒ–åˆ—è¡¨æ˜¾ç¤º */
        #resultContent br {
            margin-bottom: 5px;
            /* å¢åŠ æ®µè½é—´è· */
            content: "";
            display: block;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'accent-blue': '#3b82f6',
                        'accent-dark': '#1e293b',
                    }
                }
            }
        }
    </script>
</head>

<body class="min-h-screen p-3 sm:p-6 md:p-8">

    <div id="app" class="max-w-2xl lg:max-w-3xl mx-auto">
        <header class="text-center mb-8 sm:mb-10">
            <nav class="mb-6">
                <a href="index.html" 
                   class="inline-flex items-center 
                          px-4 py-2 
                          bg-white text-accent-dark 
                          font-semibold text-sm 
                          rounded-full 
                          shadow-lg hover:shadow-xl hover:bg-gray-50 
                          border border-gray-200 
                          transition duration-200">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0h6"></path>
                    </svg>
                    è¿”å›åŠŸèƒ½é€‰æ‹©é¦–é¡µ
                </a>
            </nav>

            <h1 class="h1-responsive font-extrabold text-accent-dark mb-2">
                ğŸ¤– æ—¥è¯­è¡¨è¾¾ä¸è¯­æ³•æ£€æŸ¥
            </h1>
            <p class="text-responsive text-gray-500">
                è¾“å…¥æ‚¨çš„æ—¥è¯­å¥å­ï¼Œè®© Gemini AI ç»™å‡ºæœ€åœ°é“çš„ä¿®æ­£å’Œè¯¦ç»†è§£é‡Šã€‚
            </p>
        </header>

        <div id="sentenceChecker" class="p-4 sm:p-6 md:p-8 bg-white rounded-xl shadow-2xl border border-gray-100">
            <div class="flex flex-col space-y-4">
                <label for="sentenceInput" class="h2-responsive font-semibold text-gray-700">è¾“å…¥æ—¥è¯­å¥å­:</label>
                <textarea id="sentenceInput"
                    class="w-full p-3 border-2 border-gray-300 rounded-lg focus:ring-accent-blue focus:border-accent-blue transition duration-150 h-32 resize-none text-base"
                    placeholder="è¯·è¾“å…¥æ‚¨çš„æ—¥è¯­å¥å­ï¼ˆä¾‹å¦‚ï¼šç§ã¯æ˜¨æ—¥ã€å›³æ›¸é¤¨ã«æœ¬ã‚’å€Ÿã‚ŠãŸã€‚ï¼‰"></textarea>

                <button id="checkSentenceButton"
                    class="w-full px-6 py-3 bg-accent-blue text-white font-semibold rounded-xl shadow-lg hover:bg-blue-600 transition duration-300 transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-accent-blue/50 disabled:bg-gray-400">
                    ğŸ“ æ£€æŸ¥å¹¶ä¿®æ­£å¥å­
                </button>
            </div>

            <div id="checkStatusMessage" class="text-center text-sm text-gray-600 mt-3"></div>

            <div id="checkResultContainer"
                class="mt-6 p-4 sm:p-5 bg-gray-50 rounded-lg border border-gray-200 hidden min-h-32">
                <h3 class="text-xl font-bold text-gray-800 mb-3 pb-1 border-b border-gray-300">AI æ£€æŸ¥ç»“æœ</h3>
                <div id="resultContent" class="text-gray-800 leading-relaxed"></div>
            </div>
        </div>

    </div>

    <script>
        // âš ï¸ å¿…å¡«ï¼šè¯·å°†æ­¤å¤„çš„ URL æ›¿æ¢ä¸ºæ‚¨çœŸå®çš„ Vercel åŸŸåï¼
        const API_URL_BASE = "https://vocab-api-server-on-vercel.vercel.app";
        const API_URL_CHECK_SENTENCE = `${API_URL_BASE}/api/check-sentence`;
        const FRONTEND_TIMEOUT_MS = 60000; // 60 ç§’è¶…æ—¶

        const sentenceInput = document.getElementById('sentenceInput');
        const checkSentenceButton = document.getElementById('checkSentenceButton');
        const checkResultContainer = document.getElementById('checkResultContainer');
        const checkStatusMessage = document.getElementById('checkStatusMessage');
        const resultContent = document.getElementById('resultContent');


        /**
         * ğŸ’¥ æ–°çš„è§£æå‡½æ•°ï¼šè§£æ AI è¿”å›çš„æ–‡æœ¬ï¼Œåˆ†ç¦»å‡º AI è¯„ä¼°éƒ¨åˆ†å¹¶æ„é€  HTML
         * @param {string} text - åŸå§‹æ–‡æœ¬ (åŒ…å« \n å’Œ Markdown)
         * @returns {string} - åŒ…å«ç‰¹æ®Šè¯„ä¼°ç›’å­çš„ HTML å­—ç¬¦ä¸²
         */
        function formatAndStructureResult(text) {
            // 1. å°†æ‰€æœ‰ \n æ›¿æ¢ä¸º <br>ï¼Œæ–¹ä¾¿æ­£åˆ™åŒ¹é…å’Œæ˜¾ç¤º
            const htmlText = text.replace(/\n/g, '<br>');

            let assessmentHtml = '';
            let mainContent = htmlText;

            // 2. ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æŸ¥æ‰¾ ã€AI è©•ä¾¡ã€‘ å’Œ ã€ä¿®æ­£ã¨èª¬æ˜ã€‘ ä¹‹é—´çš„å†…å®¹
            // åŒ¹é…æ ¼å¼ï¼š **ã€AI è©•ä¾¡ã€‘** <br> (è¯„ä¼°å†…å®¹) (?= **ã€ä¿®æ­£ã¨èª¬æ˜ã€‘**)
            const assessmentMatch = htmlText.match(/\*\*ã€AI è©•ä¾¡ã€‘\*\*\s*<br>(.*?)(?=\*\*ã€ä¿®æ­£ã¨èª¬æ˜ã€‘\*\*)/s);

            if (assessmentMatch && assessmentMatch[1]) {
                // æå–è¯„ä¼°æ–‡æœ¬ (å·²ç»åŒ…å«äº† <br>)
                const assessmentText = assessmentMatch[1].trim();

                // æ„å»ºè¯„ä¼°ç›’å­ HTML
                assessmentHtml = `
                    <div class="ai-assessment-box">
                        <div class="ai-assessment-title">ğŸ’¡ AI ç»¼åˆè¯„ä¼°</div>
                        <div>${assessmentText}</div>
                    </div>
                `;

                // ç§»é™¤è¯„ä¼°éƒ¨åˆ†ï¼Œä¿ç•™å…¶ä½™å†…å®¹ä½œä¸ºä¸»å†…å®¹
                // æˆ‘ä»¬å°† ã€AI è©•ä¾¡ã€‘ å’Œå…¶å†…å®¹ç§»é™¤ï¼Œç•™ä¸‹ ã€åŸå§‹å¥å­ã€‘ å’Œ ã€ä¿®æ­£ã¨èª¬æ˜ã€‘ éƒ¨åˆ†
                mainContent = htmlText.replace(assessmentMatch[0], `<br><br>**ã€ä¿®æ­£ã¨èª¬æ˜ã€‘**`);
            }

            // 3. å¤„ç†å‰©ä½™å†…å®¹ï¼šæ›¿æ¢ **ç²—ä½“**
            // å°† **ç²—ä½“** æ›¿æ¢ä¸º <strong class="highlight-md">
            let finalHtml = mainContent.replace(/\*\*(.*?)\*\*/g, '<strong class="highlight-md">$1</strong>');

            // 4. é‡æ–°ç»„åˆï¼šå°†è¯„ä¼°ç›’å­æ”¾åœ¨æœ€å‰é¢
            return assessmentHtml + finalHtml;
        }


        /**
         * å¤„ç†å¥å­æ£€æŸ¥çŠ¶æ€
         */
        function setCheckStatus(message, isLoading) {
            checkStatusMessage.textContent = message;
            checkSentenceButton.disabled = isLoading;
            checkSentenceButton.textContent = isLoading
                ? 'ğŸ¤– æ­£åœ¨åŠªåŠ›æ£€æŸ¥ä¸­...'
                : 'ğŸ“ æ£€æŸ¥å¹¶ä¿®æ­£å¥å­';
        }

        /**
         * è°ƒç”¨ /api/check-sentence API
         */
        async function checkSentence() {
            const sentence = sentenceInput.value.trim();

            if (sentence.length === 0) {
                setCheckStatus('è¯·è¾“å…¥æ‚¨æƒ³è¦æ£€æŸ¥çš„æ—¥è¯­å¥å­ï¼', false);
                return;
            }

            // æ£€æŸ¥å¥å­é•¿åº¦é™åˆ¶ (ä¸åç«¯ä¿æŒä¸€è‡´)
            const maxLen = 300;
            if (sentence.length > maxLen) {
                setCheckStatus(`å¥å­å¤ªé•¿ï¼è¯·é™åˆ¶åœ¨ ${maxLen} ä¸ªå­—ç¬¦ä»¥å†…ã€‚`, false);
                return;
            }

            setCheckStatus('æ­£åœ¨å‘ AI è¯·æ±‚æ£€æŸ¥...', true);
            resultContent.innerHTML = '';
            checkResultContainer.classList.add('hidden');

            try {
                // ä½¿ç”¨ POST è¯·æ±‚å‘é€å¥å­
                const response = await axios.post(API_URL_CHECK_SENTENCE, {
                    sentence: sentence
                }, {
                    timeout: FRONTEND_TIMEOUT_MS,
                    validateStatus: (status) => status >= 200 && status < 505
                });

                const data = response.data;

                if (response.status !== 200 || !data.result) {
                    const errorDetail = data.error || 'æœªæ”¶åˆ°æœ‰æ•ˆç»“æœ';
                    throw new Error(`HTTP é”™è¯¯ï¼çŠ¶æ€ç : ${response.status}. è¯¦æƒ…: ${errorDetail}`);
                }

                setCheckStatus('âœ… æ£€æŸ¥å®Œæˆï¼', false);

                // ğŸ’¥ å…³é”®ï¼šè°ƒç”¨æ–°çš„ç»“æ„åŒ–æ ¼å¼åŒ–å‡½æ•°å¤„ç† AI è¿”å›çš„æ–‡æœ¬
                const formattedResult = formatAndStructureResult(data.result);

                resultContent.innerHTML = formattedResult;
                checkResultContainer.classList.remove('hidden');

            } catch (error) {
                console.error("Sentence Check Error:", error);

                let displayMessage;
                if (axios.isCancel(error) || error.code === 'ECONNABORTED') {
                    displayMessage = `è¯·æ±‚è¶…æ—¶ï¼AI æ£€æŸ¥è€—æ—¶è¿‡é•¿ã€‚è¯·ç¨åé‡è¯•ã€‚`;
                } else if (error.response) {
                    const status = error.response.status;
                    const errorDetail = error.response.data?.error || error.message;
                    displayMessage = `æœåŠ¡å™¨é”™è¯¯ (${status})ã€‚è¯¦æƒ…: ${errorDetail}`;
                } else {
                    displayMessage = `å¥å­æ£€æŸ¥å¤±è´¥ã€‚è¯¦æƒ…: ${error.message}`;
                }

                setCheckStatus(`âŒ æ£€æŸ¥å¤±è´¥: ${displayMessage}`, false);
                checkResultContainer.classList.add('hidden');
            }
        }


        // ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
        checkSentenceButton.addEventListener('click', checkSentence);

        // é¡µé¢åŠ è½½å®Œæˆåçš„å¤„ç†
        window.onload = () => {
            setCheckStatus('è¾“å…¥å¥å­å¹¶ç‚¹å‡»æŒ‰é’®å¼€å§‹æ£€æŸ¥ã€‚', false);
        };
    </script>
</body>

</html>