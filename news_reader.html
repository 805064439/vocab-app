<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥è¯­æ¯æ—¥æ–°é—»</title>
    <!-- å¼•å…¥ Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- è®¾ç½® Tailwind é…ç½®ï¼Œä½¿ç”¨ Inter å­—ä½“ï¼Œå¹¶é…ç½®ä¸»é¢˜è‰² -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'Noto Sans CJK JP', 'sans-serif'],
                    },
                    colors: {
                        'primary-blue': '#1D4ED8', // Tailwind blue-700
                        'japanese-red': '#E11D48', // Tailwind rose-600
                        'kanji-bg': '#F3F4F6',    // Tailwind gray-100
                    }
                }
            }
        }
    </script>
    <style>
        /* éšè—æ»šåŠ¨æ¡ï¼Œä¿æŒç•Œé¢å¹²å‡€ */
        body {
            font-family: 'Inter', 'Noto Sans CJK JP', sans-serif;
            background-color: #f7f9fb;
        }
        /* Markdown åŒæ˜Ÿå·é«˜äº®æ ·å¼ */
        .news-content b {
            font-weight: 700;
            color: #E11D48; /* ä½¿ç”¨æ—¥æ–‡çº¢ */
            background-color: #FEE2E2; /* æµ…çº¢èƒŒæ™¯ */
            padding: 1px 4px;
            border-radius: 4px;
        }
        /* ç¡®ä¿é“¾æ¥å’ŒæŒ‰é’®çš„è§¦æ§å‹å¥½æ€§ */
        .touch-target {
            min-height: 48px;
        }
    </style>
</head>
<body class="min-h-screen p-4 sm:p-8 flex justify-center items-start">
    <div id="app" class="w-full max-w-4xl bg-white rounded-xl shadow-2xl p-6 md:p-10 border border-gray-100">

        <!-- å¤´éƒ¨æ ‡é¢˜ -->
        <header class="text-center mb-8">
            <h1 class="text-4xl font-extrabold text-gray-900 border-b-4 border-primary-blue pb-2 inline-block">
                æ¯æ—¥æ–°é—»å­¦ä¹ 
            </h1>
            <p class="mt-2 text-gray-500">ä½¿ç”¨ Gemini AI æä¾›çš„æœ€æ–°æ—¥è¯­æ–°é—»å’Œè¯æ±‡è§£æ</p>
        </header>

        <!-- åŠ è½½çŠ¶æ€/é”™è¯¯/å†…å®¹åŒº -->
        <div id="content-area">
            <div id="loading-indicator" class="text-center p-12 hidden">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary-blue mx-auto mb-3"></div>
                <p class="text-lg text-primary-blue">æ­£åœ¨åŠªåŠ›è·å–æœ€æ–°æ–°é—»...</p>
            </div>

            <div id="error-message" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-xl relative" role="alert">
                <strong class="font-bold">åŠ è½½å¤±è´¥ï¼š</strong>
                <span id="error-text" class="block sm:inline"></span>
            </div>

            <!-- æ–°é—»å†…å®¹å¡ç‰‡å°†æ¸²æŸ“åˆ°è¿™é‡Œ -->
            <div id="news-card" class="hidden space-y-8">
                <!-- Title and Source -->
                <section class="border-b pb-4 border-gray-200">
                    <h2 id="news-title" class="text-2xl font-bold text-gray-800 mb-2"></h2>
                    <a id="news-source" target="_blank" class="text-sm text-blue-500 hover:text-primary-blue hover:underline transition">
                        æŸ¥çœ‹åŸå§‹æ–°é—»æ¥æº
                    </a>
                </section>

                <!-- æ—¥æ–‡åŸæ–‡éƒ¨åˆ† -->
                <section>
                    <h3 class="text-xl font-semibold text-gray-700 border-l-4 border-japanese-red pl-3 mb-4">
                        <span class="mr-2">ğŸ‡¯ğŸ‡µ</span> æ—¥æ–‡åŸæ–‡ (News JP)
                    </h3>
                    <div id="news-jp" class="news-content text-lg text-gray-800 leading-relaxed bg-kanji-bg p-4 rounded-lg shadow-inner">
                        <!-- æ—¥æ–‡å†…å®¹ -->
                    </div>
                </section>

                <!-- ä¸­æ–‡ç¿»è¯‘éƒ¨åˆ† -->
                <section>
                    <h3 class="text-xl font-semibold text-gray-700 border-l-4 border-primary-blue pl-3 mb-4">
                        <span class="mr-2">ğŸ‡¨ğŸ‡³</span> ä¸­æ–‡ç¿»è¯‘ (Translation CN)
                    </h3>
                    <div id="translation-cn" class="news-content text-base text-gray-600 leading-loose p-4 rounded-lg border border-gray-200">
                        <!-- ä¸­æ–‡å†…å®¹ -->
                    </div>
                </section>

                <!-- è¯æ±‡æ³¨éŸ³è¡¨ -->
                <section>
                    <h3 class="text-xl font-semibold text-gray-700 border-l-4 border-gray-500 pl-3 mb-4">
                        <span class="mr-2">ğŸ“š</span> é‡ç‚¹è¯æ±‡æ³¨éŸ³ (Reading Map)
                    </h3>
                    <div id="reading-map-container" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- æ³¨éŸ³åˆ—è¡¨å°†æ¸²æŸ“åˆ°è¿™é‡Œ -->
                    </div>
                </section>
            </div>
        </div>
        
        <!-- åˆ·æ–°æŒ‰é’® -->
        <footer class="mt-8 pt-6 border-t border-gray-200 text-center">
            <button id="refresh-button" class="touch-target bg-primary-blue hover:bg-blue-800 text-white font-semibold py-3 px-8 rounded-full shadow-lg transition duration-300 transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-primary-blue focus:ring-opacity-50 flex items-center justify-center mx-auto" onclick="fetchDailyNewsData()">
                <svg id="refresh-icon" class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m15.356 2H20V4m-2 2a8 8 0 11-13.39-4.87L4.5 7.5"></path></svg>
                é‡æ–°åŠ è½½æœ€æ–°æ–°é—»
            </button>
        </footer>

    </div>

    <script>
        // *** ä¿®å¤ç‚¹: å°† API_ENDPOINT æ›´æ”¹ä¸ºå®Œæ•´çš„ HTTPS é“¾æ¥ ***
        const API_ENDPOINT = 'https://vocab-api-server-on-vercel.vercel.app/api/daily-news';

        // è·å– DOM å…ƒç´ 
        const loadingIndicator = document.getElementById('loading-indicator');
        const errorMessage = document.getElementById('error-message');
        const errorText = document.getElementById('error-text');
        const newsCard = document.getElementById('news-card');
        const newsTitle = document.getElementById('news-title');
        const newsSource = document.getElementById('news-source');
        const newsJp = document.getElementById('news-jp');
        const translationCn = document.getElementById('translation-cn');
        const readingMapContainer = document.getElementById('reading-map-container');
        const refreshButton = document.getElementById('refresh-button');
        
        /**
         * è¾…åŠ©å‡½æ•°ï¼šå°†åŒæ˜Ÿå·æ ¼å¼çš„æ–‡æœ¬è½¬æ¢ä¸º HTML bold æ ‡ç­¾ã€‚
         * ä½œç”¨æ˜¯é«˜äº®æ˜¾ç¤º **è¯æ±‡**ã€‚
         * @param {string} text - åŒ…å« Markdown åŒæ˜Ÿå·çš„æ–‡æœ¬ã€‚
         * @returns {string} - åŒ…å« <b> æ ‡ç­¾çš„ HTML å­—ç¬¦ä¸²ã€‚
         */
        function formatBoldText(text) {
            // æ­£åˆ™è¡¨è¾¾å¼åŒ¹é… **ä»»æ„å†…å®¹**
            return text.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>');
        }

        /**
         * æ¸²æŸ“è¯æ±‡æ³¨éŸ³è¡¨
         * @param {Record<string, string>} readingMap - æ±‰å­—è¯æ±‡åˆ°ç‰‡å‡åè¯»éŸ³çš„æ˜ å°„è¡¨ã€‚
         */
        function renderReadingMap(readingMap) {
            readingMapContainer.innerHTML = '';
            const words = Object.keys(readingMap);

            if (words.length === 0) {
                readingMapContainer.innerHTML = '<p class="text-gray-500">æœ¬ç¯‡æ–°é—»æœªæä¾›é¢å¤–çš„è¯æ±‡æ³¨éŸ³ã€‚</p>';
                return;
            }

            words.forEach(word => {
                const reading = readingMap[word];

                const item = document.createElement('div');
                item.className = 'flex flex-col bg-gray-50 p-3 rounded-lg border border-gray-200 shadow-sm transition hover:shadow-md';
                item.innerHTML = `
                    <p class="text-sm font-medium text-gray-500 mb-1">è¯æ±‡ (Kanji)</p>
                    <p class="text-2xl font-bold text-gray-900 mb-2">${word}</p>
                    <p class="text-sm font-medium text-gray-500 mb-1">è¯»éŸ³ (Reading)</p>
                    <p class="text-lg text-japanese-red font-mono bg-white p-2 rounded-md border border-dashed border-japanese-red">
                        ${reading}
                    </p>
                `;
                readingMapContainer.appendChild(item);
            });
        }

        /**
         * æ ¸å¿ƒæ•°æ®è·å–å‡½æ•°
         */
        async function fetchDailyNewsData() {
            // 1. è®¾ç½® UI çŠ¶æ€ä¸ºåŠ è½½ä¸­
            newsCard.classList.add('hidden');
            errorMessage.classList.add('hidden');
            loadingIndicator.classList.remove('hidden');
            refreshButton.disabled = true;
            refreshButton.classList.add('opacity-50', 'cursor-not-allowed');

            try {
                // ä½¿ç”¨å®Œæ•´çš„ HTTPS URL
                const response = await fetch(API_ENDPOINT);

                if (!response.ok) {
                    // å¤„ç† HTTP é”™è¯¯ (ä¾‹å¦‚ 404, 500)
                    let errorDetails = `æœåŠ¡å™¨è¿”å›é”™è¯¯ä»£ç : ${response.status}`;
                    try {
                        const errorJson = await response.json();
                        errorDetails = errorJson.error || errorDetails;
                    } catch (e) {
                        // å¿½ç•¥é JSON å“åº”çš„è§£æé”™è¯¯
                    }
                    throw new Error(errorDetails);
                }

                /** * @typedef {object} NewsItem
                 * @property {string} title_jp - åŸå§‹æ–°é—»æ ‡é¢˜
                 * @property {string} source_url - åŸå§‹æ–°é—»å‡ºå¤„é“¾æ¥
                 * @property {string} news_jp - æ—¥è¯­æ­£æ–‡ï¼Œé‡è¦è¯æ±‡ç”¨ **åŒæ˜Ÿå·** æ ‡è®°
                 * @property {Record<string, string>} reading_map - æ±‰å­—è¯æ±‡åˆ°ç‰‡å‡åè¯»éŸ³çš„æ˜ å°„è¡¨
                 * @property {string} translation_cn - ä¸­æ–‡ç¿»è¯‘ï¼Œå¯¹åº”è¯æ±‡ç”¨ **åŒæ˜Ÿå·** æ ‡è®°
                 */
                /** @type {NewsItem} */
                const data = await response.json();

                // 2. æ¸²æŸ“æ–°é—»æ•°æ®
                newsTitle.textContent = data.title_jp;
                
                // è®¾ç½®é“¾æ¥
                newsSource.href = data.source_url;
                newsSource.textContent = `æŸ¥çœ‹åŸå§‹æ–°é—»æ¥æº (${data.source_url.substring(0, 40)}...)`;

                // æ¸²æŸ“æ—¥æ–‡åŸæ–‡ï¼Œå¹¶é«˜äº®é‡ç‚¹è¯æ±‡
                newsJp.innerHTML = formatBoldText(data.news_jp);
                
                // æ¸²æŸ“ä¸­æ–‡ç¿»è¯‘ï¼Œå¹¶é«˜äº®å¯¹åº”è¯æ±‡
                translationCn.innerHTML = formatBoldText(data.translation_cn);
                
                // æ¸²æŸ“æ³¨éŸ³è¡¨
                renderReadingMap(data.reading_map);

                // 3. æ˜¾ç¤ºæ–°é—»å¡ç‰‡
                newsCard.classList.remove('hidden');

            } catch (error) {
                // 4. å¤„ç†å¹¶æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                console.error("è·å–æ–°é—»æ•°æ®å¤±è´¥:", error);
                errorText.textContent = error.message;
                errorMessage.classList.remove('hidden');
                
            } finally {
                // 5. æ— è®ºæˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œéƒ½éšè—åŠ è½½æŒ‡ç¤ºå™¨å¹¶å¯ç”¨æŒ‰é’®
                loadingIndicator.classList.add('hidden');
                refreshButton.disabled = false;
                refreshButton.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåç«‹å³è·å–æ•°æ®
        window.onload = fetchDailyNewsData;
    </script>
</body>
</html>
